d3.sankey=function(){function r(){f.forEach(function(a){a.sourceLinks=[];a.targetLinks=[]});n.forEach(function(a){var c=a.source,b=a.target;"number"===typeof c&&(c=a.source=f[a.source]);"number"===typeof b&&(b=a.target=f[a.target]);c.sourceLinks.push(a);b.targetLinks.push(a)})}function s(){f.forEach(function(a){a.value=Math.max(d3.sum(a.sourceLinks,g),d3.sum(a.targetLinks,g),a.val)})}function t(){for(var a=f,c,b=0;a.length;)c=[],a.forEach(function(a){a.x=b;a.dx=p;a.sourceLinks.forEach(function(a){c.push(a.target)})}), a=c,++b;u(b);v((m[0]-p)/(b-1))}function u(a){f.forEach(function(c){c.sourceLinks.length||(c.x=a-1)})}function v(a){f.forEach(function(c){c.x*=a})}function w(a){function c(a){function b(a){return(a.source.y+a.source.dy/2)*a.value}l.forEach(function(d,c){d.forEach(function(d){if(d.targetLinks.length){var c=d3.sum(d.targetLinks,b)/d3.sum(d.targetLinks,g);d.y+=(c-(d.y+d.dy/2))*a}})})}function b(a){function b(a){return(a.target.y+a.target.dy/2)*a.value}l.slice().reverse().forEach(function(d){d.forEach(function(d){if(d.sourceLinks.length){var c= d3.sum(d.sourceLinks,b)/d3.sum(d.sourceLinks,g);d.y+=(c-(d.y+d.dy/2))*a}})})}function e(){l.forEach(function(a){var b,d;d=0;var c=a.length,e;for(e=0;e<c;++e)b=a[e],d-=b.y,0<d&&(b.y+=d),d=b.y+b.dy+h;d=d-h-m[1];if(0<d)for(d=b.y-=d,e=c-2;0<=e;--e)b=a[e],d=b.y+b.dy+h-d,0<d&&(b.y-=d),d=b.y})}var l=d3.nest().key(function(a){return a.x}).sortKeys(d3.ascending).entries(f).map(function(a){return a.values});(function(){var a=d3.min(l,function(a){return(m[1]-(a.length-1)*h)/d3.sum(a,g)});l.forEach(function(b){b.forEach(function(b, c){b.y=c;b.dy=b.value*a})});n.forEach(function(b){b.dy=b.value*a})})();e();for(var k=1;0<a;--a)b(k*=0.99),e(),c(k),e()}function q(){function a(a,c){return a.source.y-c.source.y}function c(a,c){return a.target.y-c.target.y}f.forEach(function(b){b.sourceLinks.sort(c);b.targetLinks.sort(a)});f.forEach(function(a){var c=0,e=0;a.sourceLinks.forEach(function(a){a.sy=c;c+=a.dy});a.targetLinks.forEach(function(a){a.ty=e;e+=a.dy})})}function g(a){return a.value}var e={},p=24,h=8,m=[1,1],f=[],n=[];e.nodeWidth= function(a){if(!arguments.length)return p;p=+a;return e};e.nodePadding=function(a){if(!arguments.length)return h;h=+a;return e};e.nodes=function(a){if(!arguments.length)return f;f=a;return e};e.links=function(a){if(!arguments.length)return n;n=a;return e};e.size=function(a){if(!arguments.length)return m;m=a;return e};e.layout=function(a){r();s();t();w(a);q();return e};e.relayout=function(){q();return e};e.link=function(){function a(a){var e=a.source.x+a.source.dx,f=a.target.x,k=d3.interpolateNumber(e, f),h=k(c),k=k(1-c),g=a.source.y+a.sy+a.dy/2;a=a.target.y+a.ty+a.dy/2;return"M"+e+","+g+"C"+h+","+g+" "+k+","+a+" "+f+","+a}var c=0.5;a.curvature=function(b){if(!arguments.length)return c;c=+b;return a};return a};return e};